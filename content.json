{"meta":{"title":"小彩鸟","subtitle":"一起成长","description":"一起成长","author":"Clouduncle","url":"https://blog.utone.xyz","root":"/"},"pages":[{"title":"","date":"2020-05-24T11:58:18.542Z","updated":"2019-11-21T12:26:18.000Z","comments":true,"path":"404.html","permalink":"https://blog.utone.xyz/404.html","excerpt":"","text":""},{"title":"Archives","date":"2017-09-20T12:49:56.000Z","updated":"2019-11-21T12:26:18.000Z","comments":false,"path":"archive/index.html","permalink":"https://blog.utone.xyz/archive/index.html","excerpt":"","text":""},{"title":"About","date":"2015-07-16T04:00:00.000Z","updated":"2020-05-25T00:04:39.638Z","comments":true,"path":"about/index.html","permalink":"https://blog.utone.xyz/about/index.html","excerpt":"","text":""},{"title":"search","date":"2020-05-24T15:41:20.797Z","updated":"2020-05-24T15:40:11.568Z","comments":true,"path":"search/index.html","permalink":"https://blog.utone.xyz/search/index.html","excerpt":"","text":""},{"title":"tags","date":"2020-05-24T12:46:29.221Z","updated":"2020-05-24T12:46:29.221Z","comments":true,"path":"tags/index.html","permalink":"https://blog.utone.xyz/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"linux","slug":"linux1","date":"2015-07-18T04:00:00.000Z","updated":"2020-05-29T06:30:54.212Z","comments":true,"path":"2015/07/18/linux1/","link":"","permalink":"https://blog.utone.xyz/2015/07/18/linux1/","excerpt":"","text":"[root@hadoop102 ~]root : 指的是默认管理员 有最大权限hadoop102 : 指的是机器名~ : 指的是当前该用户的家目录 命令介绍/路径是linux的根路径 1) pwd : 查看当前光标所在的目录 ls命令2) ls : 查看&emsp;&emsp;ls -l 显示额外信息(权限 用户用户组 时间 大小) 等价于:ll&emsp;&emsp;ll -a 也显示隐藏文件夹、文件&emsp;&emsp;&emsp;&emsp;隐藏文件和文件夹都是以‘.’开头，我们可以自己隐藏文件或文件夹&emsp;&emsp;ll -h 查看 文件 的大小&emsp;&emsp;ll -rt : 其中 -r -t是按照时间排序,可以快速找到哪些文件或者文件夹更新了 3) cd : 切换路径&emsp;&emsp;cd .. : 返回上一层目录&emsp;&emsp;cd - : 回退到上一次的目录 家目录root是系统管理员用户 家目录是 /root创建的普通用户xx 家目录是 /home/xx 家目录是 ~ 表示如何进入家目录??&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; ① cd /root&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; ② cd 直接回车&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; ③ cd ~ 4) mkdir : 创建文件夹&emsp;&emsp;需求：创建并联的三个文件夹 mkdir dir1 dir2 dir3&emsp;&emsp;需求：创建串联的三个文件夹 mkdir -p dir4/dir5/dir65) help : 命令帮助&emsp;&emsp;ls –help6) clear : 清空屏幕 或者 Ctrl+l 查看文件/文件夹大小查看文件大小： ll -h 、du -sh查看文件夹大小: du -sh 移动拷贝7) mv : 移动&emsp;&emsp;标准写法 : mv dir1 dir0/dir1&emsp;&emsp;不标准写法: mv dir1 dir08) cp : 拷贝&emsp;&emsp;标准写法 : cp -r dir2 dir0/dir2&emsp;&emsp;不标准写法: cp -r dir2 dir0 &emsp;&emsp;mv是始终一份 速度快&emsp;&emsp;cp是两份 速度慢一点 创建文件9) touch : 创建空文件10) vi : 创建文件并编辑&emsp;&emsp; vi 1.log&emsp;&emsp;&emsp;&emsp;默认命令模式 。i建 进入编辑模式 。Esc建 从编辑模式进入命令模式 。Shift+:建从命令行模式进入尾行模式,输入wq退出11) echo : 打印12) &gt; : 创建或者覆盖 (高危命令)&emsp;&emsp;&emsp;&emsp;echo “hello” &gt; 3.log13) &gt;&gt; : 追加&emsp;&emsp;&emsp;&emsp;echo “hello world” &gt;&gt; 3.log 查看文件内容14) cat 查看文件内容,文件内容一次全部显示 ctrl+z中断15) more 文件内容一页页往下翻，按空格往下 无法回退 q退出16）less 文件内容 按↑↓键翻行 q退出 用的少&emsp;&emsp;&emsp;&emsp;cat适合文件内容少的。 文件内容稍微多点的用more17）tail&emsp;&emsp;tail -f xxx.log 实时监控文件内容，如果文件移除停止监控,再创建xxx.log文件也不会继续监控&emsp;&emsp;tail -F xxx.log 实时监控文件内容，如果文件移除会继续尝试读取内容不会停止,再创建xxx.log文件后还能继续监控 需求:实时查看文件内容倒数100行&emsp;&emsp;tail -100f xxx.log 注意:此处只能f不能用F 需求:文件内容很多,如何搜索error信息 ‘|’:管道符,前面的结果作为后面的输入‘grep’:过滤&emsp;&emsp;cat xxx.log | grep -A 5 ERROR error后5行信息&emsp;&emsp;cat xxx.log | grep -B 5 ERROR error前5行信息&emsp;&emsp;cat xxx.log | grep -C 5 ERROR error前后各5行信息 但是如果error很多,用cat可能会刷屏,所以优化为: cat xxx.log | grep -C 5 ERROR &gt; 20150718error.log 上传下载命令安装工具包 yum install -y lrzszsz xxx.log是下载 Linux–》window 下载位置查看CRT的配置rz+回车 是上传 window–》Linux 别名18) 别名 alias[root@ruozedata001 log]# aliasalias cp=’cp -i’alias egrep=’egrep –color=auto’alias fgrep=’fgrep –color=auto’alias grep=’grep –color=auto’alias l.=’ls -d .* –color=auto’alias ll=’ls -l –color=auto’alias ls=’ls –color=auto’alias mv=’mv -i’alias rm=’rm -i’alias which=’alias | /usr/bin/which –tty-only –read-alias –show-dot –show-tilde’ 上面解释了为什么ls -l可以简写为ll &emsp;&emsp;创建别名 : alias jj=’cd /tmp’ (注意中间不要乱用空格) (只在当前会话生效,想要全局生效需要把命令拷贝到对应用户的配置文件然后生效文件) 全局变量全局变量(配置完了需要生效配置,并且重新打开CRT窗口)全局：/etc/profile 所有用户都可以使用个人: 只能当前用户使用,其他不能使用&emsp;&emsp; ~/.bash_profile&emsp;&emsp; ~/.bashrc (个人环境变量设置推荐这个文件) 场景: ssh 远程执行B机器 命令 找不到 java command not found但是直接登录B机器 命令是能找到的,原因:命令的环境变量配置在.bash_profile 是不正确的。应该配置在.bashrc文件里面 生效文件:&emsp;&emsp;source /etc/profile&emsp;&emsp;source ~/.bash_profile&emsp;&emsp;source ~/.bashrc CRT窗口是静态窗口,配置生效后可以重新打开个窗口,拿到最新状态 创建用户19) useradd clouduncle :添加用户clouduncle20) su clouduncle:切换用户clouduncle 历史命令21) history&emsp;自己写的命令不想让别人看到 : history -c (清空history)直连 服务器 history -c可以生效跳板机(vpn) 连接 服务器 history -c可以生效堡垒机 敲一个命令都记录在堡垒机系统里,一般都有可视化web界面,能搜索谁做了什么命令 history -c就不会有效果 高危命令&emsp;&emsp; 千万不要做 rm -rf / 运维可以限制这个命令失效&emsp;&emsp;删除文件: rm 11.log 会询问是否删除&emsp;&emsp;不询问直接删除文件: rm -f 11.log&emsp;&emsp;删除文件夹: rm -r dir1&emsp;&emsp;不询问直接删除文件夹: rm -rf dir1 场景: 注意&emsp;&emsp;脚本里&emsp;&emsp;LOG_PATH=/xxx/yyy&emsp;&emsp;&emsp;&emsp;业务逻辑判断去赋值,如果漏掉了一种没有赋值那么LOG_PATH为空&emsp;&emsp;rm -rf ${LOG_PATH} /* ==&gt; rm -rf /* 怎么避免?每次执行这个命令之前 , 先判断${LOG_PATH}是否存在然后才能执行 发生了怎么办？如果不小心执行了这个操作且没有备份，则马上停止所有服务不要往硬盘上再写数据了，让运维去拿着硬盘去维修公司恢复数据。最好是运维做出这种命令限制 用户和用户组（一般都是由运维操作，除非平台运维都由自己团队接过来）用户1）创建普通用户clouduncle: useradd clouduncle&emsp;&emsp;同时也会创建clouduncle的用户组,设置clouduncle用户的组为clouduncle,且把clouduncle用户组设置为主组同时也创建家目录 /home/clouduncle &emsp;&emsp;用户存储信息一般记录在: /etc/passwd&emsp;&emsp;用户组存储信息一般记录在: /etc/group 2）查看用户clouduncle信息：id clouduncle 3) 删除用户clouduncle：userdel clouduncle删除用户后, /home/clouduncle文件夹还存在,之后手动删除该文件夹下的所有文件包括隐藏文件模拟全局变量丢失。重新创建clouduncle用户出现问题: 123456789101112[root@hadoop102 home]# su cloudunclebash-4.1$ [root@hadoop102 clouduncle]# ll -a &#x2F;etc&#x2F;skel&#x2F;.*总用量 36drwxr-xr-x. 4 root root 4096 2月 8 2018 .drwxr-xr-x. 107 root root 12288 5月 25 21:03 ..-rw-r--r--. 1 root root 18 5月 11 2016 .bash_logout-rw-r--r--. 1 root root 176 5月 11 2016 .bash_profile-rw-r--r--. 1 root root 124 5月 11 2016 .bashrcdrwxr-xr-x. 2 root root 4096 11月 12 2010 .gnome2drwxr-xr-x. 4 root root 4096 2月 8 2018 .mozilla 出现上述问题原因是当前用户的家目录里面缺少了全局变量信息,此时如下操作: 1[root@hadoop102 clouduncle]# cp &#x2F;etc&#x2F;skel&#x2F;.* .&#x2F; 4)切换用户: su&emsp;&emsp;推荐: su - clouduncle (其中’-‘代表该用户切换到家目录,且执行环境变量文件) 5)普通用户临时使用root的最大权限 : sudo&emsp;&emsp;root用户下&emsp;&emsp;&emsp;&emsp;vi /etc/sudoers&emsp;&emsp;&emsp;&emsp;添加 : clouduncle ALL=(root) NOPASSWD:ALL 生产中可以要求运维给自己linux用户加一个sudo的权限 设置密码1)修改用户密码: passwd&emsp;&emsp;passwd+回车 修改当前光标所属用户密码&emsp;&emsp;passwd clouduncle 修改clouduncle的密码 2)./etc/passwd文件下面两种情况切换用户都会失败&emsp;&emsp;clouduncle:x:1004:1005::/home/clouduncle:/sbin/nologin 提示&emsp;&emsp;clouduncle:x:1004:1005::/home/clouduncle:/usr/bin/false 没提示 CDH平台很多用户如 hdfs yarn hivesu - yarn是不成功的,原因是yarn的/sbin/nologin /usr/bin/false 需要改成 /bin/bash 用户组1)创建组bigdata : groupadd bigdata2)查看组: cat /etc/group|grep bigdata3)将用户分配到bigdata组: (usermod –help查询方法) 123[root@hadoop102 clouduncle]# usermod -a -G bigdata clouduncle[root@hadoop102 clouduncle]# id clouduncle uid&#x3D;501(clouduncle) gid&#x3D;501(clouduncle) 组&#x3D;501(clouduncle),502(bigdata) 4)设置bigdata为用户clouduncle主组(gid): usermod -g bigdata clouduncle 123456[root@hadoop102 clouduncle]# usermod -g bigdata clouduncle[root@hadoop102 clouduncle]# id clouduncleuid&#x3D;501(clouduncle) gid&#x3D;502(bigdata) 组&#x3D;502(bigdata)[root@hadoop102 clouduncle]# usermod -a -G clouduncle clouduncle[root@hadoop102 clouduncle]# id clouduncleuid&#x3D;501(clouduncle) gid&#x3D;502(bigdata) 组&#x3D;502(bigdata),501(clouduncle) 权限-rw-r–r– 1 root root 9 Apr 18 20:50 22.logdrwxr-xr-x 2 root root 6 Apr 15 22:12 dir3 &emsp;&emsp;第一个字母：d文件夹 -文件 l连接 &emsp;&emsp;后面9个字母,3个字母为一组:r:read 读权限 代表数字是4w:write 写权限 代表数字是2x: 执行 代表数字是1-: 没权限 代表数字是0 占位 7=4 2 15=4 16=4 2 &emsp;&emsp;rw- 第一组 6 代表文件或文件夹的所属用户，读写权限&emsp;&emsp;r– 第二组 4 代表文件或文件夹的所属用户组，读权限&emsp;&emsp;r– 第三组 4 代表其他用户组的用户对这个文件或文件夹，读权限 例子: rw-r- -r- - root root 22.log&emsp;&emsp;可以看到22.log 属于root用户 属于root用户组&emsp;&emsp;root用户看前三个对22.log有读和写的权限。root用户组看中间对22.log有读权限。其他用户组的用户看后三个，对22.log有读权限 关于权限：&emsp;&emsp;chmod -R 777 文件或文件夹 (777分别对应所属用户、所属用户组、其他用户组的用户 所拥有的权限)(7=4 2 1)&emsp;&emsp;chown -R 用户:用户组 文件或文件夹其中-R ： 以递归方式更改所有的文件及子目录chmod是修改文件或文件夹对不同用户不同用户组的权限chown是给文件夹或文件修改所属用户和用户组 案例:[root@hadoop102 tmp]# vi clouduncle.logwww.baidu.com [clouduncle@hadoop102 tmp]$ cat clouduncle.logwww.baidu.com[clouduncle@hadoop102 tmp]$ 收回其他组的r权限[root@hadoop102 tmp]# chmod 640 clouduncle.log[clouduncle@hadoop102 tmp]$ cat clouduncle.logcat: clouduncle.log: Permission denied 搜索场景：接手大数据平台，服务器登录，大数据组件安装目录在哪？&emsp;&emsp; find / -name ‘hadoop‘ (/表示从根目录开始,是通配符) 如果生产服务器挂10个盘,那么每个盘都要扫描&emsp;&emsp; find /opt/module -name ‘*hadoop‘ 补充:history 命令ps -ef 查看进程 vi&emsp;&emsp;&emsp;&emsp;默认命令模式 。i建 进入编辑模式 。Esc建 从编辑模式进入命令模式 。Shift+:建从命令行模式进入尾行模式,输入wq退出，wq!强制保存退出，q!强制退出不保存正常编辑一个文件，要正常退出 wq&emsp;&emsp;如果编辑的时候进程被杀死没正常退出:&emsp;&emsp;-rw-r–r– 1 root root 16 Apr 19 21:26 2.log&emsp;&emsp;-rw-r–r– 1 root root 12288 Apr 19 21:31 .2.log.swp&emsp;&emsp;之后再次编辑会无法编辑出现found a swap file by the name “.2.log.swp”&emsp;&emsp;解决方法:删除”.2.log.swp”文件,这是个隐藏文件需要ll -a才能看到 &emsp;&emsp;注意粘贴的坑,如果在命令模式的时候直接粘贴会出现第一行内容丢失 不完整,所以必须先进入编辑模式才能粘贴 如果想要搜索文件XXX内容可以 尾行模式输入 /XXX如果想要显示行号,尾行模式输入 set nu 设置行号 , set nonu 取消行号如果想要知道光标所在的行,尾行模式输入 f 命令模式常用快捷方式dd 删除光标当前行dG 删除光标当前及以下的所有行ndd 删除光标当前行及以下n行 gg 光标跳转到第一行第一个字母G 光标跳转到最后一行第一个字母shift + $ 行尾 场景：清空这个文件内容，从另外一个文件内容 拷贝过来gg–》dG –》 i –&gt;鼠标右键单击 粘贴上 清空补充：cat /dev/null &gt; 1.logecho “” &gt; 2.logtrue &gt; 1.log 也是清空文件内容 0字节 [root@ruozedata001 ~]# lltotal 16-rw-r–r– 1 root root 0 Apr 19 21:58 1.log-rw-r–r– 1 root root 1 Apr 19 21:58 2.log 可以看到第一种方式清空是0字节，第二种方式清空还有一个字节其实并没有真正清空还有个空白行 场景:shell脚本，对数据文件清空操作，根据字节大小判断是否清空完成echo “” &gt; 2.logif filezie &gt; 0 then 业务不操作 else 2.log 灌业务数据 上面清空操作是错误文件自己数不会为0，永远不会进入业务操作 linux两个机制&emsp;&emsp; oom-killer机制：当linux服务器某个进程使用内存超标 Linux机器为了保护自己，会主动杀死进程，释放内存。这个就是本来我的进程好好的，过了一夜莫名其妙的挂了，可能就是触发了这个机制。&emsp;&emsp; /tmp目录 30天自动删除机制 结束了","categories":[],"tags":[{"name":"linux","slug":"linux","permalink":"https://blog.utone.xyz/tags/linux/"}]}],"categories":[],"tags":[{"name":"linux","slug":"linux","permalink":"https://blog.utone.xyz/tags/linux/"}]}